# Полная настройка для запуска в сети

## Быстрый старт для Railway/Render/Heroku

### Шаг 1: Настройте переменные окружения

См. файл `DEPLOY_ENV.md` для полного списка переменных.

**Минимально необходимые:**
- `DATABASE_URL` - автоматически создается при подключении PostgreSQL
- `JWT_SECRET` - сгенерируйте случайную строку (минимум 32 символа)
- `FRONTEND_URL` - URL вашего фронтенд приложения
- `QR_POINT_SECRET` - сгенерируйте случайную строку (минимум 32 символа)

### Шаг 2: Подключите репозиторий

Подключите этот GitHub репозиторий к вашей платформе деплоя.

### Шаг 3: Настройте команды сборки и запуска

**Build Command:**
```bash
npm run build
```

**Start Command:**
```bash
npm run start
```

### Шаг 4: Выполните миграции базы данных

После первого деплоя подключитесь к контейнеру и выполните:

```bash
cd backend
npx prisma migrate deploy
```

Или автоматически при старте (уже настроено в start команде).

### Шаг 5: Создайте первого администратора

Через API или подключившись к базе данных.

## Структура проекта

- `package.json` - корневой workspace
- `backend/` - Express API сервер
- `frontend/` - React приложение
- `backend/src/index.ts` - точка входа backend
- `backend/prisma/` - схемы и миграции базы данных

## Автоматическая настройка

Проект настроен для автоматического деплоя:

1. ✅ Установка зависимостей через `npm install`
2. ✅ Генерация Prisma клиента через `postinstall` скрипт
3. ✅ Сборка проекта через `npm run build`
4. ✅ Выполнение миграций при старте
5. ✅ Запуск сервера через `npm run start`

## Проверка работоспособности

После деплоя проверьте:

1. Health check: `GET /api/health`
2. API доступен: `GET /api/health` должен вернуть `{"status":"ok"}`
3. CORS настроен правильно для вашего FRONTEND_URL

## Решение проблем

### База данных не подключается

- Проверьте DATABASE_URL
- Убедитесь, что база данных доступна из сети
- Проверьте SSL настройки (может потребоваться `?sslmode=require`)

### Ошибки при сборке

- Проверьте версию Node.js (требуется 18+)
- Убедитесь, что все зависимости в package.json

### Миграции не выполняются

Выполните вручную:
```bash
cd backend
npx prisma migrate deploy
```

### CORS ошибки

Проверьте, что FRONTEND_URL настроен правильно и совпадает с реальным доменом.

