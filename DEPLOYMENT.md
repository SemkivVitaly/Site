# Инструкция по развертыванию в сети

## Требуемые переменные окружения

Настройте следующие переменные окружения в вашей платформе деплоя:

### Обязательные переменные:

1. **DATABASE_URL** - Строка подключения к PostgreSQL
   ```
   postgresql://user:password@host:5432/database?schema=public
   ```

2. **JWT_SECRET** - Секретный ключ для JWT токенов (минимум 32 символа)
   ```
   your-super-secret-jwt-key-change-in-production-min-32-chars
   ```

3. **JWT_EXPIRES_IN** - Время жизни токена (по умолчанию "7d")
   ```
   7d
   ```

4. **FRONTEND_URL** - URL вашего фронтенд приложения (для CORS)
   ```
   https://your-domain.com
   ```

5. **QR_POINT_SECRET** - Секретный ключ для QR кодов (минимум 32 символа)
   ```
   your-qr-secret-key-min-32-characters-long
   ```

### Опциональные переменные:

- **PORT** - Порт для backend сервера (по умолчанию 5000)
- **NODE_ENV** - Окружение (production для продакшена)
- **UPLOAD_DIR** - Директория для загрузок (по умолчанию ./uploads)
- **MAX_FILE_SIZE** - Максимальный размер файла в байтах (по умолчанию 10485760)

## Шаги развертывания

### 1. Подготовка базы данных

Убедитесь, что PostgreSQL база данных создана и доступна.

### 2. Настройка переменных окружения

Добавьте все обязательные переменные окружения в панели управления вашей платформы.

### 3. Деплой

Платформа автоматически выполнит:
- `npm install` - установка зависимостей
- `npm run build` - сборка проекта
- `npm run start` - запуск сервера

### 4. Инициализация базы данных

После первого деплоя выполните миграции:
```bash
cd backend
npx prisma migrate deploy
```

Или добавьте в скрипт start автоматическое выполнение миграций.

### 5. Создание первого администратора

После деплоя создайте первого администратора через API:

```bash
POST https://your-api-url.com/api/auth/register
Content-Type: application/json

{
  "email": "admin@typography.ru",
  "password": "secure-password",
  "firstName": "Администратор",
  "lastName": "Системы",
  "role": "ADMIN"
}
```

## Проверка работоспособности

Проверьте health check endpoint:
```
GET https://your-api-url.com/api/health
```

Должен вернуть:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

## Настройка для разных платформ

### Railway.app

1. Создайте проект
2. Добавьте PostgreSQL сервис
3. Добавьте переменные окружения
4. Подключите GitHub репозиторий
5. Railway автоматически определит настройки из package.json

### Heroku

1. Создайте приложение
2. Добавьте PostgreSQL addon
3. Настройте переменные окружения через `heroku config:set`
4. Деплой через git или GitHub

### Render

1. Создайте новый Web Service
2. Подключите репозиторий
3. Настройте переменные окружения
4. Выберите build command: `npm run build`
5. Выберите start command: `npm run start`

## Решение проблем

### Ошибка подключения к базе данных

- Проверьте, что DATABASE_URL корректна
- Убедитесь, что база данных доступна из сети
- Проверьте firewall настройки

### Ошибка миграций

Выполните миграции вручную:
```bash
npx prisma migrate deploy
```

### Ошибка сборки

- Проверьте логи сборки
- Убедитесь, что все зависимости установлены
- Проверьте версию Node.js (требуется 18+)

